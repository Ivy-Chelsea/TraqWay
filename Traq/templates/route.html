<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TraQway</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='route.css') }}">
    <script src="https://maps.googleapis.com/maps/api/js?key=07d340254fmshd96cb1998e5538ap18046djsn50e982672094&libraries=places"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <div class="nav-menu-icon">
            <img src="logo.png" alt="Menu">
        </div>
        <h1>TraQway</h1>
        <img src="{{url_for('static', filename='images/bus.png') }}" alt="Logo">
    </header>
    <main>
        <section class="welcome">
            <h2>Find stages within the CBD</h2>
            <p>TraQway got you covered. If you want to find the location of stages and different SACCOS associated</p>
            <img src="{{url_for('static', filename='images/bus1.png') }}" alt="Welcome Travel" class="welcome-image">
        </section>
        <section class="search">
            <h3>Travel...</h3>
            <form id="search-form">
                <label for="from-location">From:</label>
                <input type="text" id="from-location" placeholder="Auto-detect or enter manually">
                
                <label for="to-location">To:</label>
                <input type="text" id="to-location" placeholder="Enter destination">
                
                <label for="travel-mode">Travel Mode:</label>
                <select id="travel-mode">
                    <option value="bus">Bus</option>
                    <option value="matatu">Matatu</option>
                    <option value="walking">Walking</option>
                </select>
                
                <label for="travel-date">Date:</label>
                <input type="date" id="travel-date">
                
                <button type="button" onclick="searchRoutes()">Search</button>
            </form>
            <div id="fare-estimate">
                <button type="button" onclick="calculateFare()">Fare Estimate</button>
                <p id="fare"></p>
            </div>
            <div id="location-suggestions"></div>
            <img src="search-travel.jpg" alt="Search Travel" class="search-image">
        </section>
        <section id="map">
            <h2>Interactive Map</h2>
            <div id="map-container">
                <iframe src="kenya_stages_map.html" width="100%" height="600"frameborder="0" allowfullscreen></iframe>
            </div>
        </section>
        <section id="alerts">
            <h2>Real-Time Alerts</h2>
            <div id="alert-container"></div>
        </section>
    </main>
    <footer>
        <p>Â© 2024 TraQway</p>
    </footer>
    <script>
        function calculateFare() {
            const toLocation = document.getElementById('to-location').value.trim();
            if (!toLocation) {
                document.getElementById('fare').innerText = 'Please enter a destination.';
                return;
            }
    
            const payload = JSON.stringify({ data: [toLocation] });
    
            console.log('Request payload:', payload);
    
            fetch('https://funmisiani.app.modelbit.com/v1/predict_cost/latest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: payload
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('API response:', data);
                if (data.data && data.data.length === 2) {
                    // Round prices to 0 decimal places
                    const offPeakPrice = data.data[0].toFixed(0);
                    const peakPrice = data.data[1].toFixed(0);
                    
                    document.getElementById('fare').innerHTML = `
                        Off-Peak Price: ${offPeakPrice} <br>
                        Peak Price: ${peakPrice}
                    `;
                } else {
                    document.getElementById('fare').innerText = 'Unexpected response format.';
                }
            })
            .catch(error => {
                console.error('Error fetching fare estimate:', error);
                document.getElementById('fare').innerText = 'Error fetching fare estimate';
            });
        }
     </script>
 
    
   
</body>
</html>
